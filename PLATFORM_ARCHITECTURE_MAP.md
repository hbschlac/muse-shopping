# Muse Platform Architecture Map
**Complete System Relationships & Data Flow**

---

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MUSE PLATFORM                                  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   FRONTEND     â”‚   â”‚   BACKEND    â”‚   â”‚      SERVICES           â”‚  â”‚
â”‚  â”‚   (Mobile/Web) â”‚â”€â”€â–¶â”‚     API      â”‚â”€â”€â–¶â”‚  (Business Logic)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                        â”‚                 â”‚
â”‚                              â–¼                        â–¼                 â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                     â”‚   PostgreSQL    â”‚    â”‚  Affiliate APIs  â”‚       â”‚
â”‚                     â”‚    Database     â”‚    â”‚  (Rakuten, CJ)   â”‚       â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Platform Systems Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MUSE PLATFORM SYSTEMS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   1. DATA INGESTION LAYER                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ Retailer   â”‚  â”‚  Instagram   â”‚  â”‚  Email Receipts     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ Connectors â”‚  â”‚  Scraping    â”‚  â”‚  (Gmail API)        â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                 â”‚                     â”‚                     â”‚
â”‚           â–¼                 â–¼                     â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                2. DATA PROCESSING LAYER                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Product        â”‚  â”‚  Product     â”‚  â”‚  Price History   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Catalog Sync   â”‚  â”‚  Matching    â”‚  â”‚  Tracking        â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                  â”‚                  â”‚                   â”‚
â”‚              â–¼                  â–¼                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    3. DATABASE LAYER                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ product_     â”‚  â”‚ product_     â”‚  â”‚ product_price_       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ catalog      â”‚  â”‚ match_groups â”‚  â”‚ history              â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                  â”‚                  â”‚                     â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                               â”‚                                        â”‚
â”‚                               â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              4. INTELLIGENCE & OPTIMIZATION LAYER               â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Pricing        â”‚  â”‚ Recommend.   â”‚  â”‚ Experimentation  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Intelligence   â”‚  â”‚ Engine (AE)  â”‚  â”‚ System (EE)      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                  â”‚                  â”‚                   â”‚
â”‚              â–¼                  â–¼                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  5. ANALYTICS LAYER                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Metrics        â”‚  â”‚ Session      â”‚  â”‚ Conversion       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Service        â”‚  â”‚ Tracking     â”‚  â”‚ Funnel           â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                  â”‚                  â”‚                   â”‚
â”‚              â–¼                  â–¼                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    6. API LAYER                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Public API     â”‚  â”‚ Admin API    â”‚  â”‚ Webhook API      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Endpoints      â”‚  â”‚ Endpoints    â”‚  â”‚ Endpoints        â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow: Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER JOURNEY DATA FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. USER OPENS APP
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/session/start
   â”‚   â””â”€â–¶ Create session in user_sessions table
   â”‚       â””â”€â–¶ Track: device, browser, UTM params
   â”‚
   â”œâ”€â–¶ [Experiments] POST /experiments/assign
   â”‚   â””â”€â–¶ Assign user to A/B test variants
   â”‚       â””â”€â–¶ Store in user_experiment_assignments
   â”‚
   â””â”€â–¶ [Auth] Check if logged in
       â””â”€â–¶ Load user preferences

2. USER VIEWS NEWSFEED
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/page-view
   â”‚   â””â”€â–¶ Track page view start
   â”‚       â””â”€â–¶ Record in page_views table
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/funnel (stage: "browse")
   â”‚   â””â”€â–¶ Track funnel entry
   â”‚
   â”œâ”€â–¶ [Newsfeed] GET /newsfeed
   â”‚   â”‚
   â”‚   â”œâ”€â–¶ [Recommendation Engine]
   â”‚   â”‚   â”‚
   â”‚   â”‚   â”œâ”€â–¶ Read user_brand_follows
   â”‚   â”‚   â”œâ”€â–¶ Read user_fashion_preferences
   â”‚   â”‚   â”œâ”€â–¶ Read instagram_follows (if connected)
   â”‚   â”‚   â”œâ”€â–¶ Read style_profiles â˜…NEWâ˜…
   â”‚   â”‚   â”œâ”€â–¶ Query product_catalog
   â”‚   â”‚   â”‚
   â”‚   â”‚   â””â”€â–¶ Generate personalized feed
   â”‚   â”‚       â””â”€â–¶ Boost items based on style profile â˜…NEWâ˜…
   â”‚   â”‚
   â”‚   â”œâ”€â–¶ [Sponsored Content] â˜…NEWâ˜…
   â”‚   â”‚   â”‚
   â”‚   â”‚   â”œâ”€â–¶ Get eligible campaigns
   â”‚   â”‚   â”‚   â”œâ”€â–¶ Check frequency cap
   â”‚   â”‚   â”‚   â”œâ”€â–¶ Check budget remaining
   â”‚   â”‚   â”‚   â””â”€â–¶ Match targeting criteria
   â”‚   â”‚   â”‚
   â”‚   â”‚   â”œâ”€â–¶ Insert sponsored modules
   â”‚   â”‚   â”‚   â”œâ”€â–¶ Position 3 (hero)
   â”‚   â”‚   â”‚   â””â”€â–¶ Position 8 (mid-feed)
   â”‚   â”‚   â”‚
   â”‚   â”‚   â””â”€â–¶ Track impression
   â”‚   â”‚
   â”‚   â”œâ”€â–¶ [Pricing Intelligence]
   â”‚   â”‚   â”‚
   â”‚   â”‚   â”œâ”€â–¶ For each product:
   â”‚   â”‚   â”‚   â”œâ”€â–¶ Find match_group_id
   â”‚   â”‚   â”‚   â”œâ”€â–¶ Get all offers from product_catalog
   â”‚   â”‚   â”‚   â”œâ”€â–¶ Calculate min/max prices
   â”‚   â”‚   â”‚   â””â”€â–¶ Identify best offer
   â”‚   â”‚   â”‚
   â”‚   â”‚   â””â”€â–¶ Return enriched products with pricing
   â”‚   â”‚
   â”‚   â””â”€â–¶ [Experiments]
   â”‚       â””â”€â–¶ Apply variant config (e.g., module ordering)
   â”‚
   â””â”€â–¶ Return personalized newsfeed with best prices + sponsored content

3. USER CLICKS PRODUCT
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/page-view/end
   â”‚   â””â”€â–¶ Track time on previous page, scroll depth
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/page-view (type: "product")
   â”‚   â””â”€â–¶ Track PDP view
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/funnel (stage: "view_product")
   â”‚   â””â”€â–¶ Track funnel progression
   â”‚
   â”œâ”€â–¶ [Experiments] POST /experiments/track-click
   â”‚   â””â”€â–¶ Track for A/B test analysis
   â”‚
   â”œâ”€â–¶ [Style Profile] Update profile â˜…NEWâ˜…
   â”‚   â””â”€â–¶ Track 'click' event on product
   â”‚       â””â”€â–¶ Update style_layers based on product metadata
   â”‚
   â””â”€â–¶ [Products] GET /products/:id
       â”‚
       â”œâ”€â–¶ [Real-time Service]
       â”‚   â””â”€â–¶ Check if price needs refresh
       â”‚       â”œâ”€â–¶ If stale: Call affiliate API
       â”‚       â””â”€â–¶ Update product_catalog
       â”‚
       â”œâ”€â–¶ [Pricing Intelligence]
       â”‚   â”‚
       â”‚   â”œâ”€â–¶ Get all retailer offers
       â”‚   â”œâ”€â–¶ Calculate price range
       â”‚   â”œâ”€â–¶ Highlight best price
       â”‚   â”œâ”€â–¶ Calculate savings
       â”‚   â”‚
       â”‚   â””â”€â–¶ Return:
       â”‚       {
       â”‚         "best_offer": {
       â”‚           "store": "Nordstrom Rack",
       â”‚           "price": "$45.00",
       â”‚           "savings": "$30.00",
       â”‚           "is_best_price": true
       â”‚         },
       â”‚         "other_offers": [...]
       â”‚       }
       â”‚
       â””â”€â–¶ [Price History]
           â””â”€â–¶ GET /products/:id/price-history
               â””â”€â–¶ Return chart data

4. USER ADDS TO CART
   â”‚
   â”œâ”€â–¶ [Cart] POST /cart/items
   â”‚   â””â”€â–¶ Insert into cart_items
   â”‚
   â”œâ”€â–¶ [Style Profile] Update profile â˜…NEWâ˜…
   â”‚   â””â”€â–¶ Track 'add_to_cart' event
   â”‚       â””â”€â–¶ Strong signal for commerce_intent
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/cart-event (type: "item_added")
   â”‚   â””â”€â–¶ Track cart event
   â”‚       â””â”€â–¶ Update session cart_adds count
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/funnel (stage: "add_to_cart")
   â”‚   â””â”€â–¶ Track funnel progression
   â”‚
   â”œâ”€â–¶ [Experiments] POST /experiments/track-add-to-cart
   â”‚   â””â”€â–¶ Track for A/B test (PRIMARY METRIC)
   â”‚
   â””â”€â–¶ [Sponsored Content] Track conversion (if from sponsored) â˜…NEWâ˜…
       â””â”€â–¶ Attribute revenue to campaign

5. USER VIEWS CART
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/funnel (stage: "view_cart")
   â”‚
   â””â”€â–¶ [Cart] GET /cart
       â”‚
       â”œâ”€â–¶ Get all cart_items for user
       â”‚
       â””â”€â–¶ [Pricing Intelligence]
           â””â”€â–¶ Refresh prices for cart items
               â”œâ”€â–¶ Check if still available
               â”œâ”€â–¶ Check if price changed
               â””â”€â–¶ Alert user if savings available

6. USER CLICKS OUT TO PURCHASE
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/funnel (stage: "checkout")
   â”‚
   â”œâ”€â–¶ [Analytics] POST /analytics/cart-event (type: "converted")
   â”‚   â””â”€â–¶ Track conversion
   â”‚       â”œâ”€â–¶ Update session: purchases++, revenue+=amount
   â”‚       â””â”€â–¶ Calculate conversion rate
   â”‚
   â”œâ”€â–¶ [Experiments] POST /experiments/track-purchase
   â”‚   â””â”€â–¶ Track for A/B test analysis
   â”‚
   â””â”€â–¶ Redirect to retailer via affiliate_link
       â””â”€â–¶ Muse earns commission

7. USER CLOSES APP
   â”‚
   â””â”€â–¶ [Analytics] POST /analytics/session/end
       â””â”€â–¶ Calculate session metrics
           â”œâ”€â–¶ session_duration_seconds
           â”œâ”€â–¶ bounce = (pages_viewed == 1)
           â”œâ”€â–¶ exit_page_url
           â””â”€â–¶ Final metrics stored
```

---

## ğŸ—„ï¸ Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATABASE SCHEMA MAP                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USERS & PREFERENCES
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  users   â”‚â”€â”€â”€â”€â–¶â”‚ user_brand_follows  â”‚     â”‚ user_fashion_    â”‚
â”‚          â”‚     â”‚                     â”‚     â”‚ preferences      â”‚
â”‚ id       â”‚     â”‚ user_id (FK)        â”‚     â”‚                  â”‚
â”‚ email    â”‚     â”‚ brand_id (FK)       â”‚     â”‚ user_id (FK)     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â–¶ user_item_interactions
     â”œâ”€â”€â–¶ user_favorites
     â”œâ”€â”€â–¶ user_instagram_follows
     â””â”€â”€â–¶ user_store_accounts

PRODUCTS & CATALOG
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ product_catalog  â”‚â”€â”€â”€â”€â–¶â”‚ product_match_      â”‚     â”‚ product_price_ â”‚
â”‚                  â”‚     â”‚ groups              â”‚     â”‚ history        â”‚
â”‚ id               â”‚     â”‚                     â”‚     â”‚                â”‚
â”‚ store_id (FK)    â”‚     â”‚ id                  â”‚     â”‚ product_id(FK) â”‚
â”‚ brand_id (FK)    â”‚     â”‚ brand_id (FK)       â”‚     â”‚ price_cents    â”‚
â”‚ match_group_id   â”‚     â”‚ canonical_name      â”‚     â”‚ detected_at    â”‚
â”‚ price_cents      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ is_available     â”‚
â”‚ affiliate_link   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â–¶ product_user_interactions
     â”œâ”€â”€â–¶ product_variants
     â””â”€â”€â–¶ product_realtime_cache

ANALYTICS & METRICS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_sessions    â”‚     â”‚ page_views          â”‚     â”‚ conversion_    â”‚
â”‚                  â”‚     â”‚                     â”‚     â”‚ funnels        â”‚
â”‚ session_id (PK)  â”‚â”€â”€â”€â”€â–¶â”‚ session_id (FK)     â”‚     â”‚                â”‚
â”‚ user_id (FK)     â”‚     â”‚ page_url            â”‚     â”‚ session_id(FK) â”‚
â”‚ pages_viewed     â”‚     â”‚ page_type           â”‚     â”‚ funnel_stage   â”‚
â”‚ cart_adds        â”‚     â”‚ time_on_page_sec    â”‚     â”‚ product_id(FK) â”‚
â”‚ purchases        â”‚     â”‚ scroll_depth_%      â”‚     â”‚ reached_at     â”‚
â”‚ revenue_cents    â”‚     â”‚ product_id (FK)     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â”€â–¶ cart_events
          â”œâ”€ cart_item_id (FK)
          â”œâ”€ event_type
          â”œâ”€ value_cents
          â””â”€ occurred_at

EXPERIMENTATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ experiments      â”‚â”€â”€â”€â”€â–¶â”‚ experiment_         â”‚     â”‚ user_          â”‚
â”‚                  â”‚     â”‚ variants            â”‚     â”‚ experiment_    â”‚
â”‚ id               â”‚     â”‚                     â”‚     â”‚ assignments    â”‚
â”‚ name             â”‚     â”‚ experiment_id (FK)  â”‚     â”‚                â”‚
â”‚ status           â”‚     â”‚ name                â”‚â”€â”€â”€â”€â–¶â”‚ user_id (FK)   â”‚
â”‚ primary_metric   â”‚     â”‚ config              â”‚     â”‚ variant_id(FK) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â”€â–¶ experiment_events
          â”œâ”€ experiment_id (FK)
          â”œâ”€ variant_id (FK)
          â”œâ”€ event_type
          â””â”€ position

CART
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cart_items       â”‚
â”‚                  â”‚
â”‚ id               â”‚
â”‚ user_id (FK)     â”‚
â”‚ store_id (FK)    â”‚
â”‚ product_name     â”‚
â”‚ price_cents      â”‚
â”‚ quantity         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STYLE PROFILES â˜…NEWâ˜…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ style_profiles   â”‚â”€â”€â”€â”€â–¶â”‚ style_profile_      â”‚     â”‚ style_profile_ â”‚
â”‚                  â”‚     â”‚ events              â”‚     â”‚ snapshots      â”‚
â”‚ user_id (FK)     â”‚     â”‚                     â”‚     â”‚                â”‚
â”‚ style_layers     â”‚     â”‚ user_id (FK)        â”‚     â”‚ user_id (FK)   â”‚
â”‚ price_layers     â”‚     â”‚ event_type          â”‚     â”‚ style_layers   â”‚
â”‚ category_layers  â”‚     â”‚ source_type         â”‚     â”‚ snapshot_date  â”‚
â”‚ occasion_layers  â”‚     â”‚ source_id           â”‚     â”‚ reason         â”‚
â”‚ commerce_intent  â”‚     â”‚ weight              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ confidence       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SPONSORED CONTENT â˜…NEWâ˜…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sponsored_       â”‚â”€â”€â”€â”€â–¶â”‚ sponsored_          â”‚     â”‚ sponsored_     â”‚
â”‚ campaigns        â”‚     â”‚ impressions         â”‚     â”‚ clicks         â”‚
â”‚                  â”‚     â”‚                     â”‚     â”‚                â”‚
â”‚ id               â”‚     â”‚ campaign_id (FK)    â”‚â”€â”€â”€â”€â–¶â”‚ impression_id  â”‚
â”‚ brand_id (FK)    â”‚     â”‚ user_id (FK)        â”‚     â”‚ campaign_id    â”‚
â”‚ budget_amount    â”‚     â”‚ placement           â”‚     â”‚ user_id (FK)   â”‚
â”‚ budget_type      â”‚     â”‚ impression_cost     â”‚     â”‚ click_cost     â”‚
â”‚ start_date       â”‚     â”‚ viewed_at           â”‚     â”‚ clicked_at     â”‚
â”‚ end_date         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ status           â”‚
â”‚ priority_score   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ sponsored_          â”‚     â”‚ campaign_      â”‚
     â”‚                   â”‚ conversions         â”‚     â”‚ budget_        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚     â”‚ tracking       â”‚
                         â”‚ campaign_id (FK)    â”‚     â”‚                â”‚
                         â”‚ click_id (FK)       â”‚     â”‚ campaign_id    â”‚
                         â”‚ conversion_type     â”‚     â”‚ tracking_date  â”‚
                         â”‚ conversion_value    â”‚     â”‚ total_spent    â”‚
                         â”‚ converted_at        â”‚     â”‚ total_revenue  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SECURITY â˜…NEWâ˜…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ audit_logs       â”‚     â”‚ security_events     â”‚     â”‚ rate_limit_    â”‚
â”‚                  â”‚     â”‚                     â”‚     â”‚ tracking       â”‚
â”‚ user_id (FK)     â”‚     â”‚ event_type          â”‚     â”‚                â”‚
â”‚ action           â”‚     â”‚ severity            â”‚     â”‚ identifier     â”‚
â”‚ resource_type    â”‚     â”‚ user_id (FK)        â”‚     â”‚ endpoint       â”‚
â”‚ resource_id      â”‚     â”‚ description         â”‚     â”‚ request_count  â”‚
â”‚ performed_at     â”‚     â”‚ occurred_at         â”‚     â”‚ window_start   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ Service Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SERVICE DEPENDENCY MAP                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (Mobile/Web)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API ROUTES                                      â”‚
â”‚  /newsfeed  /products  /cart  /analytics  /experiments                 â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
     â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SERVICES LAYER                                 â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ NewsfeedService  â”‚  â”‚ ProductCatalog   â”‚  â”‚ PricingIntelli-  â”‚    â”‚
â”‚  â”‚                  â”‚  â”‚ BatchService     â”‚  â”‚ genceService     â”‚    â”‚
â”‚  â”‚ Depends on:      â”‚  â”‚                  â”‚  â”‚                  â”‚    â”‚
â”‚  â”‚ â€¢ Pricing â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–¶â”‚ Depends on:      â”‚  â”‚ Depends on:      â”‚    â”‚
â”‚  â”‚ â€¢ Preferences    â”‚  â”‚ â€¢ Database       â”‚  â”‚ â€¢ product_       â”‚    â”‚
â”‚  â”‚ â€¢ Experiments    â”‚  â”‚ â€¢ Affiliate APIs â”‚  â”‚   catalog        â”‚    â”‚
â”‚  â”‚ â€¢ Sponsored â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–¶â”‚ â€¢ product_match_ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   groups         â”‚    â”‚
â”‚                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ExperimentSvc    â”‚  â”‚ MetricsService   â”‚  â”‚ AnalyticsReport  â”‚    â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚ Service          â”‚    â”‚
â”‚  â”‚ Depends on:      â”‚  â”‚ Depends on:      â”‚  â”‚                  â”‚    â”‚
â”‚  â”‚ â€¢ Database       â”‚  â”‚ â€¢ Database       â”‚  â”‚ Depends on:      â”‚    â”‚
â”‚  â”‚ â€¢ MultiArmedBand â”‚  â”‚ â€¢ Sessions table â”‚  â”‚ â€¢ MetricsService â”‚    â”‚
â”‚  â”‚ â€¢ Analytics      â”‚  â”‚ â€¢ Page views     â”‚  â”‚ â€¢ SQL Views      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ProductRealtime  â”‚  â”‚ ProductMatching  â”‚  â”‚ CatalogSync      â”‚    â”‚
â”‚  â”‚ Service          â”‚  â”‚ Service          â”‚  â”‚ Service          â”‚    â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚    â”‚
â”‚  â”‚ Depends on:      â”‚  â”‚ Depends on:      â”‚  â”‚ Depends on:      â”‚    â”‚
â”‚  â”‚ â€¢ Affiliate APIs â”‚  â”‚ â€¢ product_       â”‚  â”‚ â€¢ BatchService   â”‚    â”‚
â”‚  â”‚ â€¢ Cache          â”‚  â”‚   catalog        â”‚  â”‚ â€¢ RealtimeServiceâ”‚    â”‚
â”‚  â”‚ â€¢ Database       â”‚  â”‚ â€¢ ML algorithms  â”‚  â”‚ â€¢ Database       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ StyleProfile     â”‚  â”‚ SponsoredContent â”‚  â”‚ Security         â”‚    â”‚
â”‚  â”‚ Service â˜…NEWâ˜…    â”‚  â”‚ Service â˜…NEWâ˜…    â”‚  â”‚ Service â˜…NEWâ˜…    â”‚    â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚    â”‚
â”‚  â”‚ Depends on:      â”‚  â”‚ Depends on:      â”‚  â”‚ Depends on:      â”‚    â”‚
â”‚  â”‚ â€¢ influencers    â”‚  â”‚ â€¢ campaigns      â”‚  â”‚ â€¢ Database       â”‚    â”‚
â”‚  â”‚ â€¢ items metadata â”‚  â”‚ â€¢ user targeting â”‚  â”‚ â€¢ Audit logging  â”‚    â”‚
â”‚  â”‚ â€¢ user events    â”‚  â”‚ â€¢ budget trackingâ”‚  â”‚ â€¢ Rate limiting  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
     â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE (PostgreSQL)                              â”‚
â”‚  â€¢ 40+ tables                                                           â”‚
â”‚  â€¢ Indexes for performance                                              â”‚
â”‚  â€¢ Views for analytics                                                  â”‚
â”‚  â€¢ Triggers for automation                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL SERVICES                                    â”‚
â”‚  â€¢ Rakuten API (products, pricing)                                      â”‚
â”‚  â€¢ Commission Junction API                                              â”‚
â”‚  â€¢ Gmail API (receipt parsing)                                          â”‚
â”‚  â€¢ Instagram API (influencer content)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Key System Interactions

### 1. Product Display Flow
```
User Views Product
    â†“
GET /products/:id
    â†“
ProductController
    â”œâ”€â–¶ ProductCatalogBatchService
    â”‚   â””â”€â–¶ Get product from database
    â”‚
    â”œâ”€â–¶ PricingIntelligenceService
    â”‚   â”œâ”€â–¶ Find match_group_id
    â”‚   â”œâ”€â–¶ Get all offers
    â”‚   â”œâ”€â–¶ Calculate best price
    â”‚   â””â”€â–¶ Return pricing data
    â”‚
    â”œâ”€â–¶ ProductRealtimeService (if stale)
    â”‚   â”œâ”€â–¶ Call affiliate API
    â”‚   â””â”€â–¶ Update database
    â”‚
    â””â”€â–¶ Return enriched product
        {
          product: {...},
          pricing: {
            best_offer: {...},
            all_offers: [...]
          }
        }
```

### 2. Personalized Newsfeed Flow
```
User Opens App
    â†“
GET /newsfeed
    â†“
NewsfeedController
    â”œâ”€â–¶ ExperimentService
    â”‚   â””â”€â–¶ Assign to variant (module ordering)
    â”‚
    â”œâ”€â–¶ NewsfeedService
    â”‚   â”œâ”€â–¶ Get user preferences
    â”‚   â”œâ”€â–¶ Get followed brands
    â”‚   â”œâ”€â–¶ Get Instagram follows
    â”‚   â”œâ”€â–¶ Query products
    â”‚   â””â”€â–¶ Score & rank items
    â”‚
    â”œâ”€â–¶ PricingIntelligenceService (batch)
    â”‚   â””â”€â–¶ Enrich with best prices
    â”‚
    â”œâ”€â–¶ Apply experiment variant
    â”‚   â””â”€â–¶ Reorder modules
    â”‚
    â””â”€â–¶ Return personalized feed
        {
          items: [...],
          modules: [...],
          experiment: {...}
        }
```

### 3. Analytics Flow
```
User Action (any)
    â†“
POST /analytics/*
    â†“
MetricsService
    â”œâ”€â–¶ Track session
    â”œâ”€â–¶ Track page view
    â”œâ”€â–¶ Track funnel stage
    â””â”€â–¶ Track cart event
    â†“
Database (instant)
    â†“
AnalyticsReportingService
    â”œâ”€â–¶ Aggregate metrics
    â”œâ”€â–¶ Calculate KPIs
    â””â”€â–¶ Generate reports
    â†“
Admin Dashboard
```

### 4. Experimentation Flow
```
User Assigned to Experiment
    â†“
POST /experiments/assign
    â†“
ExperimentService
    â”œâ”€â–¶ Hash user ID (deterministic)
    â”œâ”€â–¶ Select variant
    â”œâ”€â–¶ Store assignment
    â””â”€â–¶ Return variant config
    â†“
Apply Variant
    â”œâ”€â–¶ Change module order
    â”œâ”€â–¶ Change recommendation weights
    â””â”€â–¶ Track exposure
    â†“
User Interacts
    â†“
POST /experiments/track-*
    â†“
AnalyticsService
    â”œâ”€â–¶ Record event
    â””â”€â–¶ Calculate metrics
    â†“
Admin Reviews Results
    â†“
GET /admin/experiments/:id/report
    â†“
Statistical Analysis
    â””â”€â–¶ Declare winner
```

---

## ğŸ“ File Organization

```
muse-shopping/
â”‚
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 015_create_products_catalog.sql
â”‚   â”œâ”€â”€ 016_enhance_items_for_catalog.sql
â”‚   â”œâ”€â”€ 019_create_experimentation_system.sql
â”‚   â”œâ”€â”€ 020_create_metrics_system.sql
â”‚   â”œâ”€â”€ 021_add_security_features.sql â† Security â˜…NEWâ˜…
â”‚   â”œâ”€â”€ 022_create_style_profiles.sql â† Style Profiles â˜…NEWâ˜…
â”‚   â”œâ”€â”€ 023_populate_style_metadata.sql â† Metadata â˜…NEWâ˜…
â”‚   â””â”€â”€ 024_create_sponsored_content.sql â† Sponsored â˜…NEWâ˜…
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ productCatalogBatchService.js     [JAR - Batch Updates]
â”‚   â”‚   â”œâ”€â”€ productRealtimeService.js         [Real-time Pricing]
â”‚   â”‚   â”œâ”€â”€ catalogSyncService.js             [Orchestration]
â”‚   â”‚   â”œâ”€â”€ productMatchingService.js         [Deduplication]
â”‚   â”‚   â”œâ”€â”€ pricingIntelligenceService.js     [Best Price Highlighting]
â”‚   â”‚   â”œâ”€â”€ newsfeedService.js                [Recommendations]
â”‚   â”‚   â”œâ”€â”€ experimentService.js              [A/B Testing]
â”‚   â”‚   â”œâ”€â”€ multiArmedBanditService.js        [MAB Algorithms]
â”‚   â”‚   â”œâ”€â”€ analyticsService.js               [Experiment Analytics]
â”‚   â”‚   â”œâ”€â”€ metricsService.js                 [Metrics Tracking]
â”‚   â”‚   â”œâ”€â”€ analyticsReportingService.js      [Analytics Reports]
â”‚   â”‚   â”œâ”€â”€ styleProfileService.js â†          [Style Profiles] â˜…NEWâ˜…
â”‚   â”‚   â”œâ”€â”€ sponsoredContentService.js â†      [Sponsored Ads] â˜…NEWâ˜…
â”‚   â”‚   â””â”€â”€ securityService.js â†              [Security] â˜…NEWâ˜…
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ index.js                          [Main Router]
â”‚   â”‚   â”œâ”€â”€ newsfeedRoutes.js
â”‚   â”‚   â”œâ”€â”€ productRoutes.js
â”‚   â”‚   â”œâ”€â”€ cartRoutes.js
â”‚   â”‚   â”œâ”€â”€ experimentRoutes.js
â”‚   â”‚   â”œâ”€â”€ analyticsRoutes.js
â”‚   â”‚   â”œâ”€â”€ sponsoredContentRoutes.js â†       â˜…NEWâ˜…
â”‚   â”‚   â”œâ”€â”€ dataDeletionRoutes.js â†           â˜…NEWâ˜…
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â”œâ”€â”€ catalog.js
â”‚   â”‚       â”œâ”€â”€ experiments.js
â”‚   â”‚       â””â”€â”€ newsfeed.js
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ authMiddleware.js
â”‚   â”‚   â””â”€â”€ experimentMiddleware.js
â”‚   â”‚
â”‚   â””â”€â”€ controllers/
â”‚       â”œâ”€â”€ newsfeedController.js
â”‚       â”œâ”€â”€ productController.js
â”‚       â””â”€â”€ cartController.js
â”‚
â””â”€â”€ Documentation/
    â”œâ”€â”€ PLATFORM_SYSTEMS_STATUS.md
    â”œâ”€â”€ PLATFORM_SYSTEMS_COMPLETE.md
    â”œâ”€â”€ PLATFORM_ARCHITECTURE_MAP.md â† THIS FILE
    â”œâ”€â”€ EXPERIMENTATION_SYSTEM_COMPLETE.md
    â”œâ”€â”€ EXPERIMENTATION_QUICK_START.md
    â”œâ”€â”€ SPEC_COMPLIANCE_VERIFICATION.md
    â”œâ”€â”€ SECURITY_IMPLEMENTATION_COMPLETE.md â† â˜…NEWâ˜…
    â”œâ”€â”€ STYLE_PROFILE_INTEGRATION.md â† â˜…NEWâ˜…
    â””â”€â”€ SPONSORED_CONTENT_FINANCE_GUIDE.md â† â˜…NEWâ˜…
```

---

## ğŸš¦ API Endpoint Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API ENDPOINTS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PUBLIC ENDPOINTS (No Auth Required)
â”œâ”€â”€ /api/v1/health                              [Server health check]
â”‚
â”œâ”€â”€ /api/v1/auth/*                              [Authentication]
â”‚
â”œâ”€â”€ /api/v1/newsfeed                            [Personalized feed]
â”‚   â””â”€â–¶ Uses: Recommendations, Pricing, Experiments
â”‚
â”œâ”€â”€ /api/v1/products/:id                        [Product details]
â”‚   â””â”€â–¶ Uses: Pricing Intelligence, Real-time Service
â”‚
â”œâ”€â”€ /api/v1/products/:id/price-history          [Price charts]
â”‚   â””â”€â–¶ Uses: Pricing Intelligence
â”‚
â”œâ”€â”€ /api/v1/cart/*                              [Cart operations]
â”‚
â”œâ”€â”€ /api/v1/experiments/assign                  [Get variant]
â”œâ”€â”€ /api/v1/experiments/track-*                 [Track events]
â”‚
â”œâ”€â”€ /api/v1/analytics/*                         [Track metrics]
â”‚   â”œâ”€â”€ POST /session/start
â”‚   â”œâ”€â”€ POST /session/end
â”‚   â”œâ”€â”€ POST /page-view
â”‚   â”œâ”€â”€ POST /page-view/end
â”‚   â”œâ”€â”€ POST /funnel
â”‚   â””â”€â”€ POST /cart-event
â”‚
â””â”€â”€ /api/v1/sponsored/*                         [Sponsored Content] â˜…NEWâ˜…
    â”œâ”€â”€ GET  /eligible                          [Get campaigns for placement]
    â”œâ”€â”€ POST /impressions                       [Track impression]
    â”œâ”€â”€ POST /clicks                            [Track click]
    â””â”€â”€ POST /conversions                       [Track conversion]

ADMIN ENDPOINTS (Auth Required)
â”œâ”€â”€ /api/v1/admin/catalog/*                     [Catalog management]
â”‚
â”œâ”€â”€ /api/v1/admin/experiments/*                 [Experiment management]
â”‚   â”œâ”€â”€ POST /experiments
â”‚   â”œâ”€â”€ POST /experiments/:id/variants
â”‚   â”œâ”€â”€ POST /experiments/:id/start
â”‚   â”œâ”€â”€ GET  /experiments/:id/report
â”‚   â””â”€â”€ GET  /experiments/:id/lift
â”‚
â”œâ”€â”€ /api/v1/analytics/*                         [Analytics reports]
â”‚   â”œâ”€â”€ GET /sessions
â”‚   â”œâ”€â”€ GET /page-views
â”‚   â”œâ”€â”€ GET /top-pages
â”‚   â”œâ”€â”€ GET /funnel
â”‚   â”œâ”€â”€ GET /cart
â”‚   â”œâ”€â”€ GET /cart/top-products
â”‚   â”œâ”€â”€ GET /realtime
â”‚   â””â”€â”€ GET /session/:sessionId
â”‚
â””â”€â”€ /api/v1/sponsored/campaigns/*               [Campaign Management] â˜…NEWâ˜…
    â”œâ”€â”€ POST /campaigns                         [Create campaign]
    â”œâ”€â”€ GET  /campaigns                         [List campaigns]
    â”œâ”€â”€ GET  /campaigns/:id                     [Get campaign details]
    â”œâ”€â”€ PUT  /campaigns/:id                     [Update campaign]
    â”œâ”€â”€ POST /campaigns/:id/approve             [Approve campaign]
    â”œâ”€â”€ POST /campaigns/:id/reject              [Reject campaign]
    â”œâ”€â”€ POST /campaigns/:id/activate            [Activate campaign]
    â”œâ”€â”€ POST /campaigns/:id/pause               [Pause campaign]
    â””â”€â”€ GET  /campaigns/:id/performance         [Get performance metrics]
```

---

## ğŸ”„ Background Jobs & Scheduled Tasks

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SCHEDULED JOBS                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DAILY (Every 24 hours)
â”œâ”€â”€ ProductCatalogBatchService.importStoreCatalog()
â”‚   â””â”€â–¶ Full catalog refresh from affiliate networks
â”‚
â””â”€â”€ CatalogSyncService.syncAllStores()
    â””â”€â–¶ Orchestrate batch updates

HOURLY
â”œâ”€â”€ ProductCatalogBatchService.updateStorePrices()
â”‚   â””â”€â–¶ Price-only updates (cheaper API calls)
â”‚
â””â”€â”€ ProductMatchingService.matchNewProducts()
    â””â”€â–¶ Match newly added products

ON-DEMAND (Triggered by User Interaction)
â”œâ”€â”€ ProductRealtimeService.refreshProduct()
â”‚   â””â”€â–¶ Real-time price check when user views product
â”‚
â””â”€â”€ MetricsService.track*()
    â””â”€â–¶ Real-time analytics tracking

ANALYTICS AGGREGATION (Daily at midnight)
â””â”€â”€ SQL Views automatically updated:
    â”œâ”€â”€ session_stats_daily
    â”œâ”€â”€ page_performance
    â”œâ”€â”€ funnel_analysis
    â””â”€â”€ cart_abandonment_stats
```

---

## ğŸ¨ Visual System Map

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    MUSE MOBILE APP      â”‚
                    â”‚      (Frontend)         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  User Actions  â”‚       â”‚ Page Views     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ANALYTICS    â”‚                              â”‚ EXPERIMENTATIONâ”‚
â”‚   TRACKING     â”‚                              â”‚   ASSIGNMENT   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                                â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚    â”‚                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NEWSFEED API    â”‚â”€â”€â”€â”€â”€â–¶â”‚ RECOMMENDER  â”‚â”€â”€â”€â”€â–¶â”‚ PRODUCT API    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                       â”‚
         â”‚                      â”‚                       â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”               â”‚
         â”‚              â”‚  USER PREFS   â”‚               â”‚
         â”‚              â”‚  â€¢ Brands     â”‚               â”‚
         â”‚              â”‚  â€¢ Occasions  â”‚               â”‚
         â”‚              â”‚  â€¢ Instagram  â”‚               â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
         â”‚                                              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ PRICING           â”‚
                â”‚ INTELLIGENCE      â”‚
                â”‚ â€¢ Best Price      â”‚
                â”‚ â€¢ Savings         â”‚
                â”‚ â€¢ Multi-retailer  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ NORDSTROM   â”‚  â”‚ NORDSTROM   â”‚  â”‚  BRAND      â”‚
â”‚             â”‚  â”‚    RACK     â”‚  â”‚  SITES      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     (Batch)         (Batch)         (Batch)
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  PRODUCT CATALOG â”‚
                â”‚    DATABASE      â”‚
                â”‚  â€¢ 1M+ products  â”‚
                â”‚  â€¢ Pricing       â”‚
                â”‚  â€¢ Availability  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Summary

### Core Data Flow:
1. **Data In:** Retailers â†’ Batch Jobs â†’ Database
2. **Intelligence:** Database â†’ Services â†’ Enriched Data
3. **Experimentation:** Users â†’ Variants â†’ Optimized Experience
4. **Analytics:** User Actions â†’ Metrics â†’ Insights
5. **Data Out:** API â†’ Frontend â†’ User

### Key Integration Points:
- **Newsfeed** uses: Recommendations + Pricing + Experiments
- **PDP** uses: Pricing Intelligence + Real-time Service + Analytics
- **Cart** uses: Pricing + Analytics + Cart Events
- **All Pages** use: Session Tracking + Experiments

### Performance Optimizations:
- Batch updates (daily) for cost efficiency
- Real-time updates (on-demand) for accuracy
- Caching for frequently accessed data
- Pre-computed views for analytics
- Deterministic experiments for consistency

**All systems work together to create a seamless, personalized, optimized shopping experience!** ğŸš€
